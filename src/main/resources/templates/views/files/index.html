<!DOCTYPE html>
<!--suppress ALL -->
<html layout:decorate="~{fragments/layouts/main_layout}"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <th:block layout:fragment="stylesheet_custom"/>
</head>
<body>

<main layout:fragment="content" role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 border-bottom">
        <h1 class="h2">Files List</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <a th:href="@{/file}" class="btn btn-sm btn-outline-secondary">
                <span data-feather="calendar"></span>
                Clear Filter
            </a>
        </div>
    </div>
    <form class="table-responsive" th:action="@{/file} " method="post">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 border-bottom">
            <div class="btn-toolbar mb-2 mb-md-0">
                <div class="form-check form-check-inline">
                    Action:
                </div>
                <div class="form-check form-check-inline" th:each="option : ${statusList}"
                     th:if="${option.name != '-select status-'}">
                    <input class="form-check-input" type="radio"
                           name="status" th:id="${option.value}" th:value="${option.value}">
                    <label class="form-check-label" th:for="${option.value}" th:text="${option.name}"></label>
                </div>
            </div>
            <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group mr-2">
                    <button type="submit" class="btn btn-sm btn-outline-secondary">Update</button>
                </div>
            </div>
        </div>

        <div class="p-2">
            <p class="mb-0 text-muted">Showing
                <span th:text="${count}">0</span> of
                <span th:text="${totalItems}"></span> results total</p>
            <p class="mb-0 text-muted">Selecting
                <span class="selecting-count">0</span> of
                <span th:text="${count}"></span> items on this page</p>
        </div>

        <table class="table table-striped table-sm">
            <thead>
            <tr>
                <th>
                    <input class="form-check-input checkboxFileList selectAll"
                           type="checkbox" name="ignore check"/>
                </th>
                <th>#</th>
                <th>File</th>
                <th>Status</th>
                <th class="d-none d-md-table-cell">Last Update</th>
                <th class="text-center">Copy</th>
            </tr>
            </thead>
            <tbody>
                <tr th:each="file : ${files}">
                    <td>
                        <!--suppress HtmlFormInputWithoutLabel -->
                        <input class="form-check-input checkboxFileList checkItem"
                               type="checkbox" name="checkedItem" th:value="${file.id}"
                               th:id="${file.id}">
                    </td>
                    <td th:text="${file.indexNumber}"></td>
                    <td th:text="${file.name}"></td>
                    <td th:text="${file.status}"></td>
                    <td class="d-none d-md-table-cell" th:text="${file.updatedAt}"></td>
                    <td class="text-center">
                        <button type="button" class="btn btn-sm btn-outline-secondary copyBtns"
                            th:data-clipboard-text="${file.name}">
                            <span class="text-small" data-feather="clipboard"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>

    <nav class="w-100 row py-2 mx-0 px-0 paginate-nav"
         aria-label="Page navigation example" th:if="${totalPages > 0}">
        <ul class="pagination mx-auto">
            <li class="page-item" th:if="${currentPage > 3}">
                <a class="page-link" aria-label="Back To First"
                   th:href="@{/file(page=1,
                    queryName = ${query}, fileStatus = ${status})}">
                    <span data-feather="chevrons-left"></span>
                </a>
            </li>
            <li class="page-item" th:if="${files.hasPrevious()}">
                <a class="page-link" aria-label="Previous"
                   th:href="@{/file(page=${currentPage - 1},
                    queryName = ${query}, fileStatus = ${status})}">
                    <span data-feather="chevron-left"></span>
                </a>
            </li>

            <li class="page-item" th:if="${currentPage > 3}">
                <a class="page-link" aria-label="Jump to"
                   data-toggle="modal" data-target="#modal"
                   href="#/">
                    ...
                </a>
            </li>

            <li th:class="${pageNumber == currentPage} ? active + ' page-item' : 'page-item'"
                th:if="${(pageNumber < (currentPage) + 3)
                && (pageNumber > (currentPage) - 3)}"
                th:each="pageNumber : ${pageNumbers}">
                <a
                        th:text="${pageNumber}"
                        class="page-link"
                        th:href="@{/file(page=${pageNumber},
                         queryName = ${query}, fileStatus = ${status})}">
                </a>
            </li>

            <li class="page-item" th:if="${currentPage < totalPages - 3}">
                <a class="page-link" aria-label="Jump to"
                   data-toggle="modal" data-target="#modal"
                   href="#/">
                    ...
                </a>
            </li>

            <li class="page-item" th:if="${files.hasNext()}">
                <a class="page-link" aria-label="Next"
                   th:href="@{/file(page=${currentPage + 1},
                   queryName = ${query}, fileStatus = ${status})}">
                    <span data-feather="chevron-right"></span>
                </a>
            </li>
            <li class="page-item" th:if="${currentPage < totalPages - 3}">
                <a class="page-link" aria-label="Go to last"
                   th:href="@{/file(page=${totalPages},
                    queryName = ${query}, fileStatus = ${status})}">
                    <span data-feather="chevrons-right"></span>
                </a>
            </li>
        </ul>
    </nav>

</main>

<th:block layout:fragment="model_content">
    <form th:action="@{/file}" class="form-inline">
        <input name="queryName" th:value="${query}" type="hidden">
        <input name="fileStatus" th:value="${status}" type="hidden">
        <div class="input-group w-100">
            <input th:placeholder="${'from 1 to ' + totalPages}"
                   type="text" class="form-control jump-page-input" id="pageJump" name="page">
            <input type="submit" value="Jump" class="btn btn-dark jump-page-btn">
        </div>

    </form>
</th:block>

<th:block layout:fragment="script_custom">
    <script type="text/javascript">
        $(document).ready(function() {
            let $checkboxes = $('.checkItem');
            let lastChecked = null;

            function countCheckbox(){
                let count = $checkboxes.filter(':checked').length;
                console.log(count);
                $('.selecting-count').html(count);
            }
            $checkboxes.click(function(e) {
                if (!lastChecked) {
                    lastChecked = this;
                    return;
                }

                if (e.shiftKey) {
                    let start = $checkboxes.index(this);
                    let end = $checkboxes.index(lastChecked);

                    $checkboxes.slice(Math.min(start,end), Math.max(start,end)+ 1).prop('checked', lastChecked.checked);
                }

                lastChecked = this;
                countCheckbox();
            });

            $('.selectAll').click(function() {
                if ($(this).is(':checked')) {
                    $('.checkItem').prop('checked', true);
                } else {
                    $('.checkItem').prop('checked', false);
                }
                countCheckbox();
            });
        });
    </script>
</th:block>

</body>
</html>
